#!/usr/bin/env python3
"""
RXinDexer REST API Server

This script starts the FastAPI REST API server alongside the ElectrumX server.
It provides HTTP endpoints for token analytics, market data, and blockchain queries.

Usage:
    ./electrumx_rest_api [--host HOST] [--port PORT]

Default: http://0.0.0.0:8000
"""

import argparse
import asyncio
import os
import sys

# Add parent directory to path for imports
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))


def main():
    parser = argparse.ArgumentParser(description='RXinDexer REST API Server')
    parser.add_argument('--host', default='0.0.0.0', help='Host to bind to')
    parser.add_argument('--port', type=int, default=8000, help='Port to bind to')
    parser.add_argument('--reload', action='store_true', help='Enable auto-reload')
    args = parser.parse_args()
    
    try:
        import uvicorn
        from electrumx.server.rest_api import app
        
        print(f"Starting RXinDexer REST API on http://{args.host}:{args.port}")
        print(f"API Docs: http://{args.host}:{args.port}/docs")
        print(f"Health Check: http://{args.host}:{args.port}/health")
        
        uvicorn.run(
            "electrumx.server.rest_api:app",
            host=args.host,
            port=args.port,
            reload=args.reload,
        )
    except ImportError as e:
        print(f"Error: Missing dependency - {e}")
        print("Install with: pip install fastapi uvicorn[standard] pydantic")
        sys.exit(1)
    except Exception as e:
        print(f"Error starting REST API: {e}")
        sys.exit(1)


if __name__ == '__main__':
    main()
